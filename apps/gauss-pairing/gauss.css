:root{
  --block: 28px;
  --gap: 6px;
  --a: #2563eb;
  --b: #10b981;
  --bg: #0b1220;
  --panel: #0f172a;
  --text: #e2e8f0;
  --muted: #94a3b8;
  --accent: #f59e0b;
  --pair-outline: #f59e0bcc;
}
*{box-sizing:border-box}
html{font-size:18px}
body{
  margin:0;
  font-family:System-ui,Segoe UI,Roboto,Tajawal,Arial,Helvetica,sans-serif;
  background:linear-gradient(120deg,#0a0f1d,#111827);
  color:var(--text)
}

header{ padding:18px 20px 8px; line-height:1.5; }
header .topbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
header h1{margin:0;font-size:1.8rem;font-weight:800}
header p{margin:.3rem 0 0;color:var(--muted);font-size:1.05rem}

.shell{max-width:1000px;margin:0 auto;padding:10px 16px 32px}

.panel{
  background:var(--panel);border:1px solid #1e293b; border-radius:16px; padding:14px;
  display:flex;flex-wrap:wrap;align-items:center;gap:10px;box-shadow:0 10px 30px rgb(0 0 0 / .25)
}
.panel label{font-size:1rem;color:var(--muted)}
.panel input[type=range]{width:200px}
.btn{
  appearance:none;border:none;cursor:pointer;border-radius:12px;padding:10px 14px;
  font-weight:700;background:#1f2937;color:#e5e7eb;transition:.2s transform,.2s opacity,.2s background
}
.btn:hover{transform:translateY(-2px);background:#374151}
.btn:active{transform:translateY(0)}
.btn.primary{background:var(--a);color:white}
.btn.primary:hover{background:#1d4ed8}
.btn.ghost{background:transparent;border:1px solid #334155}
.btn.small{padding:8px 10px;font-size:.95rem;border-radius:10px}

.zoomGroup{display:inline-flex;align-items:center;gap:8px;margin-inline-start:auto;flex-wrap:wrap}

.arena{
  position:relative; margin:18px auto 6px; padding:18px; border-radius:18px; border:1px solid #1e293b;
  background: radial-gradient(1200px 400px at 50% -10%, rgba(59,130,246,.18), rgba(16,185,129,.12) 30%, rgba(0,0,0,0) 70%), #0b1220;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.03);
}
.arena .grid{display:flex;flex-direction:column;align-items:flex-start;gap:var(--gap);min-height:calc((var(--block)+var(--gap))*8);}

.row{display:flex;align-items:center;gap:var(--gap);position:relative;min-height:var(--block);overflow:visible}
.row .label{width:40px;text-align:center;color:var(--muted);font-size:1rem}

.group{display:flex;gap:var(--gap)}
.block{width:var(--block);height:var(--block);border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.06)}
.block.a{background:linear-gradient(180deg, #3b82f6, #1e40af)}
.block.b{background:linear-gradient(180deg, #34d399, #065f46)}

/* ===== أوضاع الإكمال ===== */

/* وضع الإكمال من الأعلى */
.arena.mode-top .group.b{
  position: relative; z-index:2;
  /* البداية: تحت الصف بمقدار block+gap (ثابت آمن) */
  transform: translateY(calc(var(--block) + var(--gap)));
  opacity:0;
}
.arena.mode-top .group.b.in{
  /* النهاية: فوق السلم بمقدار الرفع المحسوب لكل صف */
  transform: translateY(calc(-1 * var(--lift, 0px)));
  opacity:1;
  transition: transform 600ms cubic-bezier(.2,.8,.2,1), opacity 600ms ease;
}

/* وضع الإكمال على اليمين (انزلاق قطري خفيف) */
.arena.mode-right .group.b{
  position: relative; z-index:2;
  /* البداية: أعلى-يسار بمقدار lift قطريًا، تنتهي عند موضعها يمين السلم */
  transform: translate(calc(-1 * var(--lift, 0px)), calc(-1 * var(--lift, 0px)));
  opacity:0;
}
.arena.mode-right .group.b.in{
  transform: translate(0,0);
  opacity:1;
  transition: transform 600ms cubic-bezier(.2,.8,.2,1), opacity 600ms ease;
}

/* أسهم التوضيح الصغيرة */
.spacer{ position:relative; width:24px; display:flex; align-items:center; justify-content:center; }
.pairArrow{ font-size:18px; line-height:1; color:var(--accent); opacity:0; transform:translateY(8px); transition:opacity .35s ease, transform .35s ease; }
.pairArrow.show{ opacity:1; transform:none; }

.legend{display:flex;gap:12px;align-items:center;margin-top:10px;color:var(--muted);font-size:1rem}
.k{display:inline-flex;align-items:center;gap:6px}
.pill{width:14px;height:14px;border-radius:4px;display:inline-block}

.formula{margin-top:16px;border-top:1px dashed #273449;padding-top:12px;color:#e5e7eb; font-size:1.05rem}
.hint{color:var(--muted);font-size:1rem}

.footer{margin-top:8px;color:var(--muted);font-size:.95rem;text-align:center}

.arena.complete::after{
  content:""; position:absolute; inset:18px; border:2px dashed var(--pair-outline); border-radius:14px; pointer-events:none; animation:outlinePulse 1.2s ease 1;
}
@keyframes outlinePulse{0%{transform:scale(.98);opacity:.4}100%{transform:scale(1);opacity:1}}

.guides{ position:absolute; inset:18px; width:calc(100% - 36px); height:calc(100% - 36px); pointer-events:none; opacity:0; transition:opacity .35s ease; }
.arena.complete .guides{ opacity:.95; }
.guides text{ font: 600 16px System-ui, Tajawal, sans-serif; fill:#e5e7eb; }
.guides .tMuted{ fill: var(--muted); }
.guides line{ stroke: var(--accent); stroke-width:2; }

.postExplain{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  background:linear-gradient(180deg,rgba(2,6,23,.0),rgba(2,6,23,.55));
  opacity:0;transform:scale(.98);pointer-events:none;transition:opacity .35s ease, transform .3s ease; z-index:5;
}
.arena.complete .postExplain{opacity:1;transform:none;pointer-events:auto}
.postExplain.hidden{ display:none !important; }
.postExplain .card{background:var(--panel);border:1px solid #334155;border-radius:16px;padding:16px 18px;max-width:720px;box-shadow:0 24px 60px rgba(0,0,0,.35)}
.postExplain h3{margin:.2rem 0 .4rem;font-size:1.1rem}
.postExplain p{margin:.35rem 0;color:var(--text)}

@media (max-width:600px){
  :root{--block:22px; --gap:5px}
  .panel{gap:8px}
  .panel input[type=range]{width:140px}
}
